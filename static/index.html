<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Liquidity Stress Monitor</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              finance: {
                teal: "#319bc6",
                lime: "#94f474",      // still available, but we won’t use it for buttons
                navy: "#0f396d",
                steel: "#4c80b0",
                gray: "#b9c1c9",
                charcoal: "#2c2c2a",
              },
              ink: "#0f396d",
              muted: "#4b5563",
              line: "#e5e7eb",
              panel: "#ffffff",
              panel2: "#f8fafc",
            },
            boxShadow: {
              shell: "0 12px 30px rgba(15,57,109,0.10)",
              card: "0 8px 18px rgba(15,57,109,0.08)",
            },
          },
        },
      };
    </script>
  </head>

  <body class="min-h-screen bg-white text-ink">
    <!-- subtle background accents -->
    <div class="pointer-events-none fixed inset-0 -z-10">
      <div class="absolute left-[8%] top-[-8%] h-[520px] w-[520px] rounded-full bg-finance-teal/10 blur-3xl"></div>
      <div class="absolute right-[6%] top-[10%] h-[520px] w-[520px] rounded-full bg-finance-steel/10 blur-3xl"></div>
      <div class="absolute left-[40%] bottom-[-10%] h-[600px] w-[600px] rounded-full bg-finance-gray/20 blur-3xl"></div>
    </div>

    <main class="mx-auto max-w-6xl px-4 py-6">
      <section class="rounded-2xl border border-line bg-panel shadow-shell overflow-hidden">
        <!-- title bar -->
        <header class="flex items-center justify-between gap-4 border-b border-line bg-panel px-4 py-3">
          <div class="flex items-center gap-2" aria-hidden="true">
            <span class="h-3.5 w-3.5 rounded-full border border-line bg-finance-gray/30"></span>
            <span class="h-3.5 w-3.5 rounded-full border border-line bg-finance-gray/30"></span>
            <span class="h-3.5 w-3.5 rounded-full border border-line bg-finance-gray/30"></span>
          </div>

          <h1 class="text-xl sm:text-2xl font-extrabold tracking-tight text-finance-navy">
            Liquidity Stress Monitor
          </h1>

          <div class="text-sm text-muted">
            <span class="text-muted">Last Updated:</span>
            <span id="lastUpdated" class="text-finance-charcoal">—</span>
          </div>
        </header>

        <!-- tabs -->
        <nav class="flex border-b border-line bg-panel2 px-3" role="tablist" aria-label="Navigation Tabs">
          <button class="px-4 py-2 text-sm font-semibold text-finance-navy bg-white rounded-t-md border-x border-t border-line -mb-px">
            Overview
          </button>
          <button class="px-4 py-2 text-sm text-muted hover:text-finance-navy">Detailed Analysis</button>
          <button class="px-4 py-2 text-sm text-muted hover:text-finance-navy">Historical Data</button>
          <button class="px-4 py-2 text-sm text-muted hover:text-finance-navy">Settings</button>
        </nav>

        <div class="bg-white p-4">
          <div class="grid grid-cols-12 gap-4">
            <!-- Controls -->
            <div class="col-span-12 rounded-2xl border border-line bg-panel shadow-card p-4">
              <div class="grid grid-cols-1 md:grid-cols-12 gap-3 items-end">
                <div class="md:col-span-6">
                  <label class="block text-xs text-muted mb-1" for="seriesSelect">Indicator (for “Selected Indicator” chart)</label>
                  <select id="seriesSelect"
                    class="w-full rounded-xl border border-line bg-white px-3 py-2 text-sm text-finance-charcoal outline-none
                           focus:ring-4 focus:ring-finance-teal/20 focus:border-finance-teal">
                  </select>
                </div>

                <div class="md:col-span-3">
                  <label class="block text-xs text-muted mb-1" for="lookback">History window (days)</label>
                  <input id="lookback" type="number" value="365" min="30" max="5000"
                    class="w-full rounded-xl border border-line bg-white px-3 py-2 text-sm text-finance-charcoal outline-none
                           focus:ring-4 focus:ring-finance-teal/20 focus:border-finance-teal"/>
                </div>

                <div class="md:col-span-2">
                  <label class="block text-xs text-muted mb-1" for="kTail">Tail threshold (k)</label>
                  <input id="kTail" type="number" value="2.5" step="0.1" min="1.5" max="6.0"
                    class="w-full rounded-xl border border-line bg-white px-3 py-2 text-sm text-finance-charcoal outline-none
                           focus:ring-4 focus:ring-finance-teal/20 focus:border-finance-teal"/>
                </div>

                <div class="md:col-span-1">
                  <button id="refresh"
                    class="w-full rounded-xl px-4 py-2 text-sm font-semibold text-white
                           bg-finance-navy hover:bg-finance-steel
                           transition-colors duration-200 shadow-md hover:shadow-lg">
                    Refresh
                  </button>
                </div>

                <div id="globalError" class="md:col-span-12 text-sm text-red-600 mt-1 min-h-[18px]"></div>
              </div>
            </div>

            <!-- KPI row (now 9 columns) + Explainer (3 columns) -->
            <div class="col-span-12 lg:col-span-9 grid grid-cols-12 gap-4">
              <!-- KPI: gauge -->
              <div class="col-span-12 md:col-span-4 rounded-2xl border border-line bg-panel shadow-card p-4">
                <div class="text-sm font-bold mb-2 text-finance-navy">Current Stress Probability</div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 items-center">
                  <div class="text-4xl font-extrabold tracking-tight text-finance-charcoal" id="stressPct">—</div>
                  <div id="gauge" class="h-[140px]"></div>
                </div>
                <div class="mt-2 text-xs text-muted">Higher means greater tail-like funding stress.</div>
              </div>

              <!-- KPI: spread -->
              <div class="col-span-12 md:col-span-4 rounded-2xl border border-line bg-panel shadow-card p-4 flex flex-col justify-center items-center min-h-[160px]">
                <div class="flex items-center justify-between w-full max-w-[260px] gap-x-6">
                  <div class="text-sm font-bold text-finance-navy flex items-center gap-2">
                    SOFR - EFFR Spread
                  </div>

                  <button
                    id="explainSpreadBtn"
                    class="inline-flex items-center gap-2 text-sm font-semibold text-finance-steel hover:text-finance-navy"
                  >
                    <span class="inline-grid place-items-center h-5 w-5 rounded-full border border-line bg-panel2 text-finance-navy">
                      i
                    </span>
                    Explain
                  </button>
                </div>

                <div class="text-5xl font-extrabold tracking-tight text-finance-charcoal" id="spreadNow">—</div>
                <div class="text-sm text-muted mt-2" id="spreadSub">—</div>
              </div>

              <!-- KPI: repo delta -->
              <div class="col-span-12 md:col-span-4 rounded-2xl border border-line bg-panel shadow-card p-4 flex flex-col justify-center items-center min-h-[160px]">

                <div class="flex items-center justify-between w-full max-w-[260px] gap-x-6">
                  <div class="text-sm font-bold text-finance-navy">
                    Repo Volume (1-Day Δ)
                  </div>

                  <button
                    id="explainRepoBtn"
                    class="inline-flex items-center gap-2 text-sm font-semibold text-finance-steel hover:text-finance-navy"
                  >
                    <span class="inline-grid place-items-center h-5 w-5 rounded-full border border-line bg-panel2 text-finance-navy">
                      i
                    </span>
                    Explain
                  </button>
                </div>

                <div class="text-5xl font-extrabold tracking-tight text-finance-charcoal" id="repoDeltaNow">—</div>
                <div class="text-sm text-muted mt-2" id="repoSub">—</div>
              </div>

            </div>

            <!-- Explainer panel -->
            <aside class="col-span-12 lg:col-span-3 rounded-2xl border border-line bg-panel shadow-card p-4">
              <div class="flex items-start justify-between gap-2">
                <div>
                  <h2 class="text-sm font-extrabold text-finance-navy" id="explainerTitle">Indicator Explainer</h2>
                  <p class="text-xs text-muted mt-1">Plain-language context for what you’re looking at.</p>
                </div>
                <span class="inline-flex items-center rounded-full border border-line bg-panel2 px-2 py-1 text-xs font-semibold text-finance-navy" id="explainerTag">
                  Overview
                </span>
              </div>

              <div class="mt-4 space-y-3 text-sm">
                <div>
                  <div class="text-xs font-bold text-muted">What it is</div>
                  <div class="mt-1 text-finance-charcoal" id="explainerWhat">Click “Explain” under a KPI to see details.</div>
                </div>
                <div>
                  <div class="text-xs font-bold text-muted">Why it matters</div>
                  <div class="mt-1 text-finance-charcoal" id="explainerWhy">The goal is to translate funding indicators into stress intuition.</div>
                </div>
                <div>
                  <div class="text-xs font-bold text-muted">What to watch</div>
                  <div class="mt-1 text-finance-charcoal" id="explainerWatch">Look for spikes, persistence, and confirmation across indicators.</div>
                </div>

                <div class="pt-3 border-t border-line">
                  <div class="text-xs font-bold text-muted">Interpretation hint</div>
                  <div class="mt-1 text-finance-charcoal" id="explainerHint">
                    Rate-based signals (spreads) and quantity-based signals (repo usage) often move at different times.
                    Watching both reduces false alarms.
                  </div>
                </div>
              </div>
            </aside>

            <!-- Charts -->
            <div class="col-span-12 lg:col-span-6 rounded-2xl border border-line bg-panel shadow-card p-4">
              <div class="flex items-baseline justify-between gap-2 mb-2">
                <h2 class="text-base font-extrabold text-finance-navy">Stress Probability Over Time</h2>
                <span class="text-xs text-muted">Moderate / High bands</span>
              </div>
              <div id="chartStress" class="h-[300px]"></div>
            </div>

            <div class="col-span-12 lg:col-span-6 rounded-2xl border border-line bg-panel shadow-card p-4">
              <div class="flex items-baseline justify-between gap-2 mb-2">
                <h2 class="text-base font-extrabold text-finance-navy">SOFR - EFFR Spread & Repo Volume</h2>
                <span class="text-xs text-muted">Line + bars</span>
              </div>
              <div id="chartCombo" class="h-[300px]"></div>
            </div>

            <!-- Analysis -->
            <div class="col-span-12 lg:col-span-6 rounded-2xl border border-line bg-panel shadow-card p-4">
              <h2 class="text-base font-extrabold mb-2 text-finance-navy">Spread Model Analysis</h2>
              <ul class="space-y-2 text-sm">
                <li class="flex items-center justify-between">
                  <span class="text-muted">Spread Volatility (20d)</span>
                  <span class="font-semibold text-finance-charcoal" id="spreadVol">—</span>
                </li>
                <li class="flex items-center justify-between">
                  <span class="text-muted">Outlier Probability</span>
                  <span class="font-semibold text-finance-charcoal" id="pSpread">—</span>
                </li>
                <li class="flex items-center justify-between">
                  <span class="text-muted">Risk Level</span>
                  <span class="font-semibold text-finance-charcoal" id="spreadRisk">—</span>
                </li>
              </ul>
            </div>

            <div class="col-span-12 lg:col-span-6 rounded-2xl border border-line bg-panel shadow-card p-4">
              <h2 class="text-base font-extrabold mb-2 text-finance-navy">Repo Model Analysis</h2>
              <ul class="space-y-2 text-sm">
                <li class="flex items-center justify-between">
                  <span class="text-muted">5-Day Repo Change</span>
                  <span class="font-semibold text-finance-charcoal" id="repoChg5">—</span>
                </li>
                <li class="flex items-center justify-between">
                  <span class="text-muted">Outlier Probability</span>
                  <span class="font-semibold text-finance-charcoal" id="pRepo">—</span>
                </li>
                <li class="flex items-center justify-between">
                  <span class="text-muted">Risk Level</span>
                  <span class="font-semibold text-finance-charcoal" id="repoRisk">—</span>
                </li>
              </ul>
            </div>

            <!-- Selected indicator -->
            <div class="col-span-12 rounded-2xl border border-line bg-panel shadow-card p-4">
              <div class="flex items-baseline justify-between gap-2 mb-2">
                <h2 class="text-base font-extrabold text-finance-navy">Selected Indicator Trend</h2>
                <span class="text-xs text-muted">Mean ± 2σ band</span>
              </div>
              <div id="chartSeries" class="h-[300px]"></div>
            </div>

            <!-- Alert banner -->
            <div id="alertBanner"
              class="col-span-12 rounded-2xl border border-line bg-finance-teal/10 shadow-card p-4 flex items-center gap-3">
              <div class="h-11 w-11 rounded-xl border border-line bg-white grid place-items-center font-black text-finance-navy">!</div>
              <div id="alertText" class="text-sm sm:text-base text-finance-charcoal">
                <span class="font-black text-finance-navy">OK:</span> No elevated liquidity stress detected.
              </div>
            </div>

            <!-- Tables -->
            <div class="col-span-12 rounded-2xl border border-line bg-panel shadow-card p-4">
              <h2 class="text-base font-extrabold mb-2 text-finance-navy">Latest Indicator Readings</h2>
              <div class="overflow-x-auto">
                <table id="stressTable" class="w-full text-sm">
                  <thead class="text-muted">
                    <tr class="[&>th]:text-left [&>th]:py-2 [&>th]:pr-4 border-b border-line">
                      <th>Indicator</th><th>Latest</th><th>Z-score</th><th>Percentile</th><th>7d change %</th><th>Score</th><th>Status</th>
                    </tr>
                  </thead>
                  <tbody class="[&>tr>td]:py-2 [&>tr>td]:pr-4"></tbody>
                </table>
              </div>
            </div>

            <div class="col-span-12 rounded-2xl border border-line bg-panel shadow-card p-4">
              <h2 class="text-base font-extrabold mb-2 text-finance-navy">Recent Alerts</h2>
              <div class="overflow-x-auto">
                <table id="alertsTable" class="w-full text-sm">
                  <thead class="text-muted">
                    <tr class="[&>th]:text-left [&>th]:py-2 [&>th]:pr-4 border-b border-line">
                      <th>Time</th><th>Indicator</th><th>Level</th><th>Message</th>
                    </tr>
                  </thead>
                  <tbody class="[&>tr>td]:py-2 [&>tr>td]:pr-4"></tbody>
                </table>
              </div>
            </div>

          </div>
        </div>
      </section>
    </main>

    <script src="/static/app.js"></script>
  </body>
</html>
